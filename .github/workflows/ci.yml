name: ci

on: [push, pull_request]

jobs:
    build-and-test:
      name: ${{ matrix.name }}
      runs-on: ${{ matrix.os }}
      strategy:
        fail-fast: false
        matrix:
          # TODO: macos and windows currently fail with wrong copts
          # settings.
          os: [ubuntu-latest]
          #os: [ubuntu-latest, macos-latest, windows-latest]
          include:
            - os: ubuntu-latest
              name: Linux
            #- os: macos-latest
            #  name: MacOs
            #- os: windows-latest
            #  name: Windows

      steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Tests
        run: bazel test --test_output=errors //...
